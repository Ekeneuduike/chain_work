<div class="page-container">
  <!-- Navbar -->
  <header class="navbar">
    <div class="menu-btn" (click)="toggleSidenav()">☰</div>
    <h3>Freelancer Dashboard</h3>
  </header>

  <!-- Sidenav -->
  <div class="overlay" *ngIf="isSidenavVisible" (click)="closeSidenav()"></div>
  <nav class="sidenav" [class.visible]="isSidenavVisible">
    <h3
      routerLink="/app/freelancer/profile"
      [queryParams]="{ active: 'profile' }"
      (click)="closeSidenav()"
    >
      Profile
    </h3>
    <h3
      routerLink="/app/freelancer/profile"
      [queryParams]="{ active: 'stats' }"
      (click)="closeSidenav()"
    >
      Stats
    </h3>
    <h3
      routerLink="/app/freelancer/profile"
      [queryParams]="{ active: 'disputes' }"
      (click)="closeSidenav()"
    >
      Disputes
    </h3>
  </nav>

  <!-- Main Content -->
  <main class="body">
    @if(active()==='profile' || !active()){

    <!-- Profile Main Section -->
    <main class="profile-main">
      <!-- Profile Header -->
      <section class="profile-header">
        <div class="profile-banner"></div>
        <div class="profile-details">
          <!-- Profile Image Section -->
          <div class="profile-image">
            <img src="../../assets/astronaut.jpg" alt="Profile Image" />
            <button
              mat-icon-button
              aria-label="Example icon button with a vertical three dot icon"
              (click)="editProfile('image')"
            >
              <mat-icon>edit</mat-icon>
            </button>
          </div>

          <!-- Profile Info Section -->
          <div class="profile-info">
            <div class="editable">
              <h1>
                John Doe
                <button
                  mat-icon-button
                  aria-label="Example icon button with a vertical three dot icon"
                  (click)="editProfile('username')"
                >
                  <mat-icon>edit</mat-icon>
                </button>
              </h1>
            </div>
            <div class="editable">
              <p class="tagline">
                Web Developer & Designer
                <button
                  mat-icon-button
                  aria-label="Example icon button with a vertical three dot icon"
                  (click)="editProfile('title')"
                >
                  <mat-icon>edit</mat-icon>
                </button>
              </p>
            </div>
            <div class="rating">
              <span>⭐⭐⭐⭐⭐</span>
              <span>(5/5)</span>
            </div>
          </div>
        </div>
      </section>

      <!-- About Me Section -->
      <section class="about-me">
        <h2>About Me</h2>
        <p>
          I am a passionate web developer with over 5 years of experience in
          creating stunning, user-friendly websites. I specialize in front-end
          development, but I also have experience working with back-end
          technologies. My goal is to build beautiful and functional websites
          that solve problems.
        </p>
        <button class="edit-btn" (click)="editProfile('bio')">Edit Bio</button>
      </section>

      <!-- Skills Section -->
      <section class="skills">
        <h2>Skills</h2>
        <ul>
          <li>HTML</li>
          <li>CSS</li>
          <li>JavaScript</li>
          <li>React</li>
          <li>Node.js</li>
        </ul>
        <button class="edit-btn" (click)="editProfile('skills')">
          Edit Skills
        </button>
      </section>

      <!-- Portfolio Section -->
      <section class="portfolio">
        <h2>Portfolio</h2>
        <div class="portfolio-item">
          <img src="project1.jpg" alt="Project 1" />
          <div class="portfolio-details">
            <h3>Website Redesign</h3>
            <p>Redesigned a corporate website to improve user experience.</p>
          </div>
        </div>
        <div class="portfolio-item">
          <img src="project2.jpg" alt="Project 2" />
          <div class="portfolio-details">
            <h3>Personal Portfolio</h3>
            <p>Created a personal portfolio website to showcase my work.</p>
          </div>
          <button
            mat-icon-button
            aria-label="Example icon button with a vertical three dot icon"
            (click)="editProfile('edit_project')"
          >
            <mat-icon>edit</mat-icon>
          </button>
        </div>
        <button class="edit-btn" (click)="editProfile('portfolio')">
          Add New Portfolio
        </button>
      </section>

      <!-- Client Reviews Section -->
      <section class="reviews">
        <h2>Client Reviews</h2>
        <div class="review">
          <span class="rating">⭐⭐⭐⭐⭐</span>
          <p>"Great work! Delivered on time and exceeded expectations."</p>
        </div>
        <div class="review">
          <span class="rating">⭐⭐⭐⭐⭐</span>
          <p>"Very skilled and professional. Highly recommend!"</p>
        </div>
      </section>
    </main>

    <style>
      /* General Reset */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background-color: #f4f4f4;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      /* Profile Header */
      .profile-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 40px;
      }

      .profile-banner {
        width: 100%;
        height: 250px;
        background-color: #ddd;
        background-image: url("./../assets/background.jpg");
        background-size: cover;
        background-position: center;
        border-radius: 10px;
      }
      .profile-banner img {
        width: 100%;
        height: 250px;
      }

      .profile-details {
        display: flex;
        align-items: center;
        margin-top: -80px;
        padding: 20px;
        background-color: white;
        border-bottom-left-radius: 10px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        width: 100%;
      }

      .profile-image img {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        border: 5px solid white;
        margin-right: 0px;
      }
      .profile-image button {
        margin-right: 100px;
        margin-left: -25px;
      }

      .profile-info h1 {
        font-size: 32px;
        margin-bottom: 10px;
      }

      .profile-info .tagline {
        font-size: 18px;
        color: #777;
        margin-bottom: 10px;
      }

      .profile-info .rating {
        font-size: 18px;
        color: #ffd700;
      }

      .profile-info .location {
        font-size: 16px;
        color: #888;
        margin-top: 5px;
      }

      /* Section Styling */
      section {
        margin-bottom: 40px;
      }

      h2 {
        font-size: 28px;
        margin-bottom: 10px;
        color: #444;
      }

      .about-me p,
      .skills ul,
      .reviews .review p {
        font-size: 16px;
        color: #555;
        line-height: 1.5;
      }

      .skills ul {
        list-style: none;
        display: flex;
        flex-wrap: wrap;
      }

      .skills ul li {
        background-color: #e4e4e4;
        padding: 10px 20px;
        margin: 5px;
        border-radius: 20px;
        font-size: 14px;
        color: #555;
      }

      .portfolio-item {
        display: flex;
        margin-bottom: 20px;
      }

      .portfolio-item img {
        width: 150px;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
        margin-right: 20px;
      }

      .portfolio-details h3 {
        font-size: 18px;
        color: #444;
      }

      .portfolio-details p {
        font-size: 14px;
        color: #666;
      }

      /* Button Styling */
      .edit-btn {
        background-color: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin-top: 10px;
      }

      .edit-btn:hover {
        background-color: #0056b3;
      }
    </style>

    } 



    @if(active()==='disputes'){ 
      
      <div class="container">
        <h1>User Disputes</h1>
      
        <!-- Dispute List -->
        <div class="dispute-list">
          <h2>Dispute List</h2>
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Title</th>
                <th>Status</th>
                <th>Date</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let dispute of disputes">
                <td>{{ dispute.id }}</td>
                <td>{{ dispute.title }}</td>
                <td>
                  <span [class]="dispute.status.toLowerCase()">
                    {{ dispute.status }}
                  </span>
                </td>
                <td>{{ dispute.date }}</td>
                <td>
                  <button (click)="selectDispute(dispute)">View Details</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      
        <!-- Dispute Details -->
        <div class="dispute-details" *ngIf="selectedDispute">
          <h2>Dispute Details</h2>
          <div class="details">
            <p><strong>Title:</strong> {{ selectedDispute.title }}</p>
            <p><strong>Status:</strong> {{ selectedDispute.status }}</p>
            <p><strong>Date:</strong> {{ selectedDispute.date }}</p>
            <p><strong>Description:</strong> {{ selectedDispute.description }}</p>
          </div>
          <button class="close-btn" (click)="selectedDispute = null">Close</button>
        </div>
      </div>
      
    }

    <!-- src/app/dashboard/dashboard.component.html -->
    <div [ngClass]="{ inview: active() === 'stats' }" class="stats">
      <div class="dashboard">
        <div class="header">
          <h1>Dashboard</h1>
        </div>
        <div class="metrics">
          <div class="metric">
            <h3>Total Earnings</h3>
            <p>${{ totalEarnings }}</p>
            <span>+20.1% from last month</span>
          </div>
          <div class="metric">
            <h3>Active Contracts</h3>
            <p>+{{ activeContracts }}</p>
            <span>+180.1% from last month</span>
          </div>
          <div class="metric">
            <h3>Pending Proposals</h3>
            <p>+{{ pendingProposals }}</p>
            <span>+19% from last month</span>
          </div>
          <div class="metric">
            <h3>Active Chats</h3>
            <p>+{{ activeChats }}</p>
            <span>+201 since last hour</span>
          </div>
        </div>
        <div class="content">
          <div class="overview">
            <h3>Overview</h3>
            <canvas id="user-chart"></canvas>
          </div>

          <div class="recent-proposals">
            <h3>Recent Proposals</h3>
            <ul>
              @for(proposal of recentProposals; track proposal){
              <li>
                <span>{{ proposal.name }}</span>
                <span>{{ proposal.project }}</span>
                <span>+${{ proposal.amount }}</span>
              </li>
              }
            </ul>
          </div>
        </div>
      </div>

      <style>
        /* src/app/dashboard/dashboard.component.css */
        .dashboard {
          display: flex;
          flex-direction: column;
          /* color: white; */
          background-color: #fff;
          padding: 20px;
        }
        .header {
          margin: 30px 0px;
        }

        .metrics {
          display: flex;
          flex-wrap: wrap;
          justify-content: space-between;
          gap: 20px;
        }

        .metric {
          background-color: #fff;
          padding: 20px;
          border-radius: 8px;
          text-align: center;
          flex: 1 1 calc(25% - 20px);
          box-sizing: border-box;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          border: 0.05px solid rgba(209, 208, 208, 0.6);
        }

        .metric h3 {
          margin: 0;
          font-size: 1.2em;
        }

        .metric p {
          margin: 10px 0;
          font-size: 1.5em;
        }

        .metric span {
          font-size: 0.9em;
          color: #bada55;
        }

        .content {
          display: flex;
          flex-wrap: wrap;
          gap: 20px;
          margin-top: 20px;
        }

        .overview,
        .recent-proposals {
          background-color: #fff;
          padding: 20px;
          border-radius: 8px;
          flex: 1 1 calc(50% - 20px);
          box-sizing: border-box;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          border: 0.05px solid rgba(209, 208, 208, 0.6);
        }

        .recent-proposals ul {
          list-style: none;
          padding: 0;
        }

        .recent-proposals li {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px;
          background-color: #fff;
          margin-bottom: 10px;
          border-radius: 8px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .proposal-details {
          display: flex;
          flex-direction: column;
        }

        .proposal-name {
          font-weight: bold;
        }

        .proposal-project {
          font-size: 0.9em;
          color: #bada55;
        }

        .proposal-amount {
          font-size: 1.1em;
          color: #bada55;
        }
      </style>
    </div>

    <!-- form for updating user info -->
    <div class="form-background" id="form-back">
      @if(full_name){
      <div class="form-container">
        <button
          mat-icon-button
          aria-label="Example icon button with a vertical three dot icon"
          (click)="closeform()"
        >
          <mat-icon>clear</mat-icon>
        </button>
        <h2>Change Your {{ change }}</h2>
        <div class="form-group">
          <label for="name">Full Name</label>
          <input
            type="text"
            id="name"
            name="name"
            class="form-control"
            required
            [(ngModel)]="fullname"
          />
        </div>
        <div class="form-group">
          <button type="submit" class="submit-btn" (click)="changeFullname()">
            Save Changes
          </button>
        </div>
      </div>
      } 
      @if(job_title){
      <div class="form-container">
        <button
          mat-icon-button
          aria-label="Example icon button with a vertical three dot icon"
          (click)="closeform()"
        >
          <mat-icon>clear</mat-icon>
        </button>
        <h2>Change Your {{ change }}</h2>
        <div class="form-group">
          <label for="name">Job Title </label>
          <input
            type="text"
            id="name"
            name="name"
            class="form-control"
            required
            [(ngModel)]="jobTitle"
          />
        </div>
        <div class="form-group">
          <button type="submit" class="submit-btn" (click)="changeJobTitle()">
            Save Changes
          </button>
        </div>
      </div>
      } 
      @if(profile_image){
      <div class="form-container">
        <button
          mat-icon-button
          aria-label="Example icon button with a vertical three dot icon"
          (click)="closeform()"
        >
          <mat-icon>clear</mat-icon>
        </button>
        <h2>Change Your {{ change }}</h2>

        <app-file-uploader
          (fileSelected)="onFileSelected($event)"
        ></app-file-uploader>
        <app-progress-bar [progress]="progress"></app-progress-bar>


        {{ selectedFile == null }}

        <div *ngIf="selectedFile" style="margin: 20px auto">
          <p>Selected File: {{ selectedFile.name }}</p>
        </div>
        <div class="form-group">
          <button
            class="submit-btn"
            (click)="changeProfileImage()"
            [disabled]="selectedFile == null"
          >
            Save Changes
          </button>
        </div>
      </div>
      } @if(open_bio){
      <div class="form-container">
        <button
          mat-icon-button
          aria-label="Example icon button with a vertical three dot icon"
          (click)="closeform()"
        >
          <mat-icon>clear</mat-icon>
        </button>
        <h2>Change Your {{ change }}</h2>
        <div class="form-group">
          <label for="name">Bio </label>
          <textarea
            id="bio"
            name="bio"
            class="form-control"
            required
            rows="4"
            [(ngModel)]="bio"
          ></textarea>
        </div>
        <div class="form-group">
          <button type="submit" class="submit-btn" (click)="changeBio()">
            Save Changes
          </button>
        </div>
      </div>
      } 
      @if(edit_skills){
      <div class="form-container">
        <button
          mat-icon-button
          aria-label="Example icon button with a vertical three dot icon"
          (click)="closeform()"
        >
          <mat-icon>clear</mat-icon>
        </button>

        <h2>Edit skills</h2>
        <div class="form-group">
          <div class="skills-container" (click)="handleContainerClick($event)">
            <div class="chip-list">
              <div *ngFor="let skill of skills" class="chip">
                {{ skill }}
                <span class="remove-chip" (click)="removeSkill(skill)">×</span>
              </div>
            </div>
            <input
              type="text"
              [(ngModel)]="skillInput"
              (input)="filterSkills()"
              (keydown.enter)="addSkill(skillInput)"
              (focus)="showSuggestions = true"
              placeholder="Add a skill"
              class="skill-input"
            />
            <ul
              class="autocomplete-list"
              *ngIf="filteredSkills.length && showSuggestions"
            >
              <li
                *ngFor="let skill of filteredSkills"
                (click)="addSkill(skill)"
              >
                {{ skill }}
              </li>
            </ul>
          </div>
        </div>
        <div class="form-group">
          <button type="submit" class="submit-btn" (click)="changeBio()">
            Save Changes
          </button>
        </div>
      </div>
      } 
      @if(edit_project){
      <div class="form-container">
        <button
          mat-icon-button
          aria-label="Example icon button with a vertical three dot icon"
          (click)="closeform()"
        >
          <mat-icon>clear</mat-icon>
        </button>
        <h2>Edit portfolio project</h2>
        <div class="form-group">
          <div class="portfolio-form-container">
            <form (ngSubmit)="onSubmit()" #portfolioForm="ngForm">
              <!-- Project Title -->
              <div class="form-group">
                <label for="title">Project Title</label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  [(ngModel)]="project.title"
                  required
                  placeholder="Enter project title"
                  class="form-control"
                />
              </div>

              <!-- Project Description -->
              <div class="form-group">
                <label for="description">Project Description</label>
                <textarea
                  id="description"
                  name="description"
                  [(ngModel)]="project.description"
                  required
                  placeholder="Describe the project"
                  class="form-control"
                  rows="4"
                ></textarea>
              </div>

              <!-- Technologies Used -->
              <div class="form-group">
                <label for="technologies">Technologies Used</label>
                <div
                  class="skills-container"
                  (click)="handleContainerClick($event)"
                >
                  <div class="chip-list">
                    <div *ngFor="let tech of tech" class="chip">
                      {{ tech }}
                      <span class="remove-chip" (click)="removeTech(tech)"
                        >×</span
                      >
                    </div>
                  </div>
                  <input
                    type="text"
                    [ngModelOptions]="{ standalone: true }"
                    [(ngModel)]="typed_tech"
                    (input)="filterTechs()"
                    (keydown.enter)="addTech(typed_tech)"
                    (focus)="showSuggestions = true"
                    placeholder="Add a skill"
                    class="skill-input"
                  />
                  <ul
                    class="autocomplete-list"
                    *ngIf="filteredSkills.length && showSuggestions"
                  >
                    <li
                      *ngFor="let tech of filteredTech"
                      (click)="addTech(tech)"
                    >
                      {{ tech }}
                    </li>
                  </ul>
                </div>
              </div>

              <!-- File Upload -->
              <div class="form-group">
                <label for="file">Upload Project Image/Document</label>
                <input
                  type="file"
                  id="file"
                  name="file"
                  (change)="onFileSelect($event)"
                  class="form-control"
                />
                <div *ngIf="project.fileName" class="file-preview">
                  <span>Uploaded File: {{ project.fileName }}</span>
                  <button type="button" (click)="removeFile()">Remove</button>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="form-actions">
                <button
                  type="submit"
                  class="btn btn-primary"
                  [disabled]="!portfolioForm.form.valid"
                >
                  Save
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  (click)="onCancel()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      } 
      @if(add_portfolio_project){
      <div class="form-container">
        <button
          mat-icon-button
          aria-label="Example icon button with a vertical three dot icon"
          (click)="closeform()"
        >
          <mat-icon>clear</mat-icon>
        </button>
        <h2>Add portfolio project</h2>
        <div class="form-group">
          <div class="portfolio-form-container">
            <form (ngSubmit)="onSubmit()" #portfolioForm="ngForm">
              <!-- Project Title -->
              <div class="form-group">
                <label for="title">Project Title</label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  [(ngModel)]="project.title"
                  required
                  placeholder="Enter project title"
                  class="form-control"
                />
              </div>

              <!-- Project Description -->
              <div class="form-group">
                <label for="description">Project Description</label>
                <textarea
                  id="description"
                  name="description"
                  [(ngModel)]="project.description"
                  required
                  placeholder="Describe the project"
                  class="form-control"
                  rows="4"
                ></textarea>
              </div>

              <!-- Technologies Used -->
              <div class="form-group">
                <label for="technologies">Technologies Used</label>
                <div
                  class="skills-container"
                  (click)="handleContainerClick($event)"
                >
                  <div class="chip-list">
                    <div *ngFor="let tech of tech" class="chip">
                      {{ tech }}
                      <span class="remove-chip" (click)="removeTech(tech)"
                        >×</span
                      >
                    </div>
                  </div>
                  <input
                    type="text"
                    [ngModelOptions]="{ standalone: true }"
                    [(ngModel)]="typed_tech"
                    (input)="filterTechs()"
                    (keydown.enter)="addTech(typed_tech)"
                    (focus)="showSuggestions = true"
                    placeholder="Add a skill"
                    class="skill-input"
                  />
                  <ul
                    class="autocomplete-list"
                    *ngIf="filteredSkills.length && showSuggestions"
                  >
                    <li
                      *ngFor="let tech of filteredTech"
                      (click)="addTech(tech)"
                    >
                      {{ tech }}
                    </li>
                  </ul>
                </div>
              </div>

              <!-- File Upload -->
              <div class="form-group">
                <label for="file">Upload Project Image/Document</label>
                <input
                  type="file"
                  id="file"
                  name="file"
                  (change)="onFileSelect($event)"
                  class="form-control"
                />
                <div *ngIf="project.fileName" class="file-preview">
                  <span>Uploaded File: {{ project.fileName }}</span>
                  <button type="button" (click)="removeFile()">Remove</button>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="form-actions">
                <button
                  type="submit"
                  class="btn btn-primary"
                  [disabled]="!portfolioForm.form.valid"
                >
                  Save
                </button>
                <button
                  type="button"
                  class="btn btn-secondary"
                  (click)="onCancel()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      }
    </div>
  </main>
</div>

@if(false || selectedFile){
<div>
  <app-file-uploader
    (fileSelected)="onFileSelected($event)"
  ></app-file-uploader>
  <div *ngIf="selectedFile">
    <p style="margin: 20px auto">Selected File: {{ selectedFile.name }}</p>
  </div>
</div>
}
